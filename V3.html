<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaspers dicot TO6 kalkylator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, button { padding: 8px; font-size: 16px; }
        .result { margin-top: 20px; font-weight: bold; }
        #kopKnapp {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            border: none;
            cursor: pointer;
            display: none;
        }
        .positive { color: green; }
        .negative { color: red; }
    </style>
</head>
<body>

<h1>Kaspers dicot TO6 kalkylator</h1>
<label for="huvudaktiePris">Ange ett fiktivt pris för huvudaktien i SEK:</label>
<input type="number" id="huvudaktiePris" step="0.01" placeholder="Ange pris"><br><br>

<label>
    <input type="checkbox" id="forutsagbartPrisCheckbox" onclick="toggleOptionPrisInput()"> Förutspå pris utan nuvarande teckningsoptionspris
</label><br><br>

<div id="optionPrisInput">
    <label for="nuvarandeOptionPris">Ange nuvarande marknadspris för teckningsoptionen i SEK:</label>
    <input type="number" id="nuvarandeOptionPris" step="0.01" placeholder="Ange pris"><br><br>
</div>

<h2>Mina köpta teckningsoptioner</h2>
<label>
    <input type="checkbox" id="ingenKoptCheckbox" onclick="toggleKoptFields()"> Jag har inte köpt några teckningsoptioner
</label><br><br>

<div id="koptFields">
    <label for="kopPrisOption">Ange ditt köppris för teckningsoptionen i SEK:</label>
    <input type="number" id="kopPrisOption" step="0.01" placeholder="Ange ditt köppris"><br><br>

    <label for="antalOptioner">Ange antal teckningsoptioner du har:</label>
    <input type="number" id="antalOptioner" step="1" placeholder="Ange antal"><br><br>
</div>

<h2>Fuck the dealer</h2>
<label>
    <input type="checkbox" id="fuckTheDealerCheckbox" onclick="toggleFuckTheDealer()"> Aktivera
</label><br><br>

<div id="fuckTheDealerFields" style="display: none;">
    <label for="antalOptionerSalj">Ange antal teckningsoptioner du kan tänka dig att sälja för att finansiera dina aktier:</label>
    <input type="number" id="antalOptionerSalj" step="1" placeholder="Ange antal"><br><br>
</div>

<button onclick="beraknaTeckningsoption()">Beräkna</button>

<div class="result" id="resultat"></div>
<button id="kopKnapp">Köp</button>

<script>
function toggleOptionPrisInput() {
    const checkbox = document.getElementById("forutsagbartPrisCheckbox");
    const optionPrisInput = document.getElementById("optionPrisInput");

    optionPrisInput.style.display = checkbox.checked ? "none" : "block";
}

function toggleKoptFields() {
    const ingenKoptCheckbox = document.getElementById("ingenKoptCheckbox");
    const koptFields = document.getElementById("koptFields");

    koptFields.style.display = ingenKoptCheckbox.checked ? "none" : "block";
}

function toggleFuckTheDealer() {
    const fuckTheDealerCheckbox = document.getElementById("fuckTheDealerCheckbox");
    const fuckTheDealerFields = document.getElementById("fuckTheDealerFields");

    fuckTheDealerFields.style.display = fuckTheDealerCheckbox.checked ? "block" : "none";
}

function formatNumber(number) {
    return new Intl.NumberFormat("sv-SE").format(number);
}

function beraknaTeckningsoption() {
    const huvudaktiePris = parseFloat(document.getElementById("huvudaktiePris").value) || 0;
    const nuvarandeOptionPris = parseFloat(document.getElementById("nuvarandeOptionPris").value) || 0;
    const kopPrisOption = parseFloat(document.getElementById("kopPrisOption").value) || 0;
    const antalOptioner = parseInt(document.getElementById("antalOptioner").value) || 0;
    const antalOptionerSalj = parseInt(document.getElementById("antalOptionerSalj").value) || 0;
    const kopKnapp = document.getElementById("kopKnapp");
    const forutsagbartPrisCheckbox = document.getElementById("forutsagbartPrisCheckbox").checked;
    const ingenKoptCheckbox = document.getElementById("ingenKoptCheckbox").checked;
    const fuckTheDealerCheckbox = document.getElementById("fuckTheDealerCheckbox").checked;

    if (huvudaktiePris <= 0) {
        alert("Ange ett giltigt pris för huvudaktien.");
        return;
    }

    if (!forutsagbartPrisCheckbox && nuvarandeOptionPris <= 0) {
        alert("Ange ett giltigt nuvarande pris för teckningsoptionen.");
        return;
    }

    if (!ingenKoptCheckbox && kopPrisOption <= 0) {
        alert("Ange ett giltigt köppris för teckningsoptionen.");
        return;
    }

    if (!ingenKoptCheckbox && antalOptioner <= 0) {
        alert("Ange ett giltigt antal teckningsoptioner.");
        return;
    }

    if (fuckTheDealerCheckbox && antalOptionerSalj <= 0) {
        alert("Ange ett giltigt antal teckningsoptioner att sälja.");
        return;
    }

    let losenPris = huvudaktiePris * 0.7;
    losenPris = Math.min(Math.max(losenPris, 0.15), 0.225);

    const totalTeckningKostnad = losenPris * 2 * (ingenKoptCheckbox ? 1 : antalOptioner);

    // Beräkna predicerat värde på teckningsoptionen baserat på huvudaktiepris enligt den nya formeln
    let prediceratOptionPris;
    if (forutsagbartPrisCheckbox) {
        if (huvudaktiePris > 0.225) {
            prediceratOptionPris = 0.225 + (huvudaktiePris - 0.225) / 2;
        } else {
            prediceratOptionPris = huvudaktiePris / 2;
        }
    } else {
        prediceratOptionPris = nuvarandeOptionPris;
    }

    let vurdering;
    kopKnapp.style.display = "block";

    if (!forutsagbartPrisCheckbox) {
        if (nuvarandeOptionPris > kopPrisOption) {
            vurdering = "Teckningsoptionen är övervärderad.";
            kopKnapp.style.backgroundColor = "red";
            kopKnapp.innerText = "Sälj";
        } else if (nuvarandeOptionPris < kopPrisOption) {
            vurdering = "Teckningsoptionen är undervärderad.";
            kopKnapp.style.backgroundColor = "green";
            kopKnapp.innerText = "Köp";
        } else {
            vurdering = "Teckningsoptionen är rätt värderad.";
            kopKnapp.style.backgroundColor = "gray";
            kopKnapp.innerText = "Neutral";
        }
    } else {
        vurdering = "Förväntat pris för teckningsoptionen baserat på huvudaktiepriset.";
        kopKnapp.style.display = "none";
    }

    let valueChange = "";
    if (!ingenKoptCheckbox && kopPrisOption > 0) {
        const vinstPerOptionSEK = prediceratOptionPris - kopPrisOption;
        const totalVinstSEK = vinstPerOptionSEK * antalOptioner;
        const vinstProcent = (vinstPerOptionSEK / kopPrisOption) * 100;

        const noedvandigHuvudAktiePris = losenPris + kopPrisOption / 2;
        const totalVinstenVidLosen = (huvudaktiePris * 2 * antalOptioner) - totalTeckningKostnad;

        valueChange = `
            <p class="${totalVinstSEK >= 0 ? 'positive' : 'negative'}">Total vinst/förlust i SEK: ${formatNumber(totalVinstSEK.toFixed(2))} SEK</p>
            <p class="${totalVinstSEK >= 0 ? 'positive' : 'negative'}">Vinst/förlust per option i SEK: ${formatNumber(vinstPerOptionSEK.toFixed(4))} SEK</p>
            <p class="${totalVinstSEK >= 0 ? 'positive' : 'negative'}">Vinst/förlust i %: ${vinstProcent.toFixed(2)} %</p>
            <p>Kostnad för att köpa ut teckningsoptionerna (${formatNumber(antalOptioner * 2)} aktier): ${formatNumber(totalTeckningKostnad.toFixed(2))} SEK</p>
            <p>Potentiell vinst vid lösen: ${formatNumber(totalVinstenVidLosen.toFixed(2))} SEK</p>
            <p>Nödvändigt huvudaktiepris för att gå plus: ${formatNumber(noedvandigHuvudAktiePris.toFixed(2))} SEK</p>
        `;
    }

    // Beräkning för "Fuck the dealer"
    let fuckTheDealerResult = "";
    if (fuckTheDealerCheckbox && antalOptionerSalj > 0) {
        const kostnadPerAktie = losenPris * 2;
        const totalAktiekostnad = kostnadPerAktie * antalOptioner;
        const nödvändigtMarknadsprisOption = totalAktiekostnad / antalOptionerSalj;

        fuckTheDealerResult = `
            <h3>Fuck the dealer</h3>
            <p>Nödvändigt marknadspris per teckningsoption för att finansiera aktieköpet med ${formatNumber(antalOptionerSalj)} sålda optioner: ${formatNumber(nödvändigtMarknadsprisOption.toFixed(4))} SEK</p>
        `;
    }

    document.getElementById("resultat").innerHTML = `
        <p>Lösenkurs per aktie: ${formatNumber(losenPris.toFixed(4))} SEK</p>
        <p>Total kostnad för aktieteckning (${formatNumber(ingenKoptCheckbox ? 2 : antalOptioner * 2)} aktier): ${formatNumber(totalTeckningKostnad.toFixed(4))} SEK</p>
        <p>Predicerat värde på teckningsoptionen baserat på huvudaktiepris: ${formatNumber(prediceratOptionPris.toFixed(4))} SEK</p>
        <p><strong>${vurdering}</strong></p>
        ${valueChange}
        ${fuckTheDealerResult}
    `;
}
</script>

</body>
</html>
